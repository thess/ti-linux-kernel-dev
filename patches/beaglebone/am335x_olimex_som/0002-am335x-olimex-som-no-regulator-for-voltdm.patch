From 3b27486431acb94f508c7a3ce8d60ae9c3c8f1bd Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Sun, 20 Dec 2015 18:06:19 -0600
Subject: [PATCH 2/2] am335x-olimex-som: no regulator for voltdm

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/boot/dts/am335x-olimex-som.dts | 2 +-
 arch/arm/mach-omap2/opp33xx_data.c      | 4 ++++
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/arch/arm/boot/dts/am335x-olimex-som.dts b/arch/arm/boot/dts/am335x-olimex-som.dts
index 63879e4..e7ee978 100644
--- a/arch/arm/boot/dts/am335x-olimex-som.dts
+++ b/arch/arm/boot/dts/am335x-olimex-som.dts
@@ -12,7 +12,7 @@
 
 / {
 	model = "Olimex AM335x SOM";
-	compatible = "ti,am33xx";
+	compatible = "ti,am335x-olimex-som", "ti,am33xx";
 };
 
 &ldo3_reg {
diff --git a/arch/arm/mach-omap2/opp33xx_data.c b/arch/arm/mach-omap2/opp33xx_data.c
index c4f5e1e..1f8c772 100644
--- a/arch/arm/mach-omap2/opp33xx_data.c
+++ b/arch/arm/mach-omap2/opp33xx_data.c
@@ -14,6 +14,7 @@
  */
 #include <linux/io.h>
 #include <linux/module.h>
+#include <linux/of.h>
 
 #include "control.h"
 #include "omap_opp_data.h"
@@ -82,6 +83,9 @@ int __init am33xx_opp_init(void)
 	if (WARN(!soc_is_am33xx(), "Cannot init OPPs: unsupported SoC.\n"))
 		return r;
 
+	if (of_machine_is_compatible("ti,am335x-olimex-som"))
+		return r;
+
 	rev = omap_rev();
 
 	switch (rev) {
-- 
2.6.4

